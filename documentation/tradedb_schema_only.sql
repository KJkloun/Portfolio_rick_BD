-- H2 2.2.224; 
SET DB_CLOSE_DELAY -1;         
;              
CREATE USER IF NOT EXISTS "SA" SALT '1e07dc1a6f646deb' HASH '3aabd00edf173b3cd39b1440965b589c4c1c00f7ab9de50292fcb7c836d6bee7' ADMIN;          
CREATE CACHED TABLE "PUBLIC"."PORTFOLIOS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 55) NOT NULL,
    "CREATED_AT" TIMESTAMP(6),
    "CURRENCY" CHARACTER VARYING(3) NOT NULL,
    "DESCRIPTION" CHARACTER VARYING(255),
    "IS_ACTIVE" BOOLEAN,
    "NAME" CHARACTER VARYING(255) NOT NULL,
    "PORTFOLIO_TYPE" CHARACTER VARYING(255) NOT NULL,
    "USER_ID" BIGINT NOT NULL
);         
ALTER TABLE "PUBLIC"."PORTFOLIOS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_35" PRIMARY KEY("ID");   
-- 24 +/- SELECT COUNT(*) FROM PUBLIC.PORTFOLIOS;              
CREATE CACHED TABLE "PUBLIC"."TRADES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 7572) SELECTIVITY 100 NOT NULL,
    "DAILY_INTEREST" CHARACTER VARYING SELECTIVITY 1,
    "ENTRY_DATE" DATE SELECTIVITY 45 NOT NULL,
    "ENTRY_PRICE" NUMERIC(38, 2) SELECTIVITY 41 NOT NULL,
    "EXIT_DATE" DATE SELECTIVITY 49,
    "EXIT_PRICE" NUMERIC(38, 2) SELECTIVITY 45,
    "MARGIN_AMOUNT" NUMERIC(38, 2) SELECTIVITY 1 NOT NULL,
    "NOTES" CHARACTER VARYING SELECTIVITY 1,
    "QUANTITY" INTEGER SELECTIVITY 1 NOT NULL,
    "SYMBOL" CHARACTER VARYING(10) SELECTIVITY 1 NOT NULL,
    "PORTFOLIO_ID" BIGINT,
    "BORROWED_AMOUNT" NUMERIC(19, 6),
    "COLLATERAL_AMOUNT" NUMERIC(19, 6),
    "FINANCING_CURRENCY" CHARACTER VARYING(5),
    "FINANCING_RATE_TYPE" CHARACTER VARYING(255),
    "LEVERAGE" NUMERIC(10, 2),
    "MAINTENANCE_MARGIN" NUMERIC(10, 4)
);    
ALTER TABLE "PUBLIC"."TRADES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_93" PRIMARY KEY("ID");       
-- 466 +/- SELECT COUNT(*) FROM PUBLIC.TRADES; 
CREATE CACHED TABLE "PUBLIC"."SPOT_TRANSACTIONS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 1131) NOT NULL,
    "AMOUNT" NUMERIC(19, 6),
    "COMPANY" CHARACTER VARYING(255),
    "NOTE" CHARACTER VARYING(255),
    "PRICE" NUMERIC(19, 6),
    "QUANTITY" NUMERIC(19, 6),
    "TICKER" CHARACTER VARYING(255),
    "TRADE_DATE" DATE,
    "TRANSACTION_TYPE" CHARACTER VARYING(255),
    "PORTFOLIO_ID" BIGINT NOT NULL
); 
ALTER TABLE "PUBLIC"."SPOT_TRANSACTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_FD" PRIMARY KEY("ID");            
-- 224 +/- SELECT COUNT(*) FROM PUBLIC.SPOT_TRANSACTIONS;      
CREATE CACHED TABLE "PUBLIC"."TRADE_CLOSURES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 204) NOT NULL,
    "CLOSED_QUANTITY" INTEGER NOT NULL,
    "EXIT_DATE" DATE NOT NULL,
    "EXIT_PRICE" NUMERIC(38, 2) NOT NULL,
    "NOTES" CHARACTER VARYING,
    "TRADE_ID" BIGINT NOT NULL
);     
ALTER TABLE "PUBLIC"."TRADE_CLOSURES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_50" PRIMARY KEY("ID");               
-- 202 +/- SELECT COUNT(*) FROM PUBLIC.TRADE_CLOSURES;         
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 4) NOT NULL,
    "CREATED_AT" TIMESTAMP(6),
    "EMAIL" CHARACTER VARYING(255) NOT NULL,
    "ENABLED" BOOLEAN NOT NULL,
    "FIRST_NAME" CHARACTER VARYING(255),
    "LAST_NAME" CHARACTER VARYING(255),
    "PASSWORD" CHARACTER VARYING(255) NOT NULL,
    "USERNAME" CHARACTER VARYING(255) NOT NULL
);   
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("ID");         
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.USERS;    
CREATE CACHED TABLE "PUBLIC"."FINANCING_EVENTS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "AMOUNT_CHANGE" NUMERIC(19, 6),
    "EVENT_DATE" DATE NOT NULL,
    "EVENT_TYPE" CHARACTER VARYING(255) NOT NULL,
    "NOTES" CHARACTER VARYING,
    "RATE" NUMERIC(10, 4),
    "TRADE_ID" BIGINT NOT NULL
);    
ALTER TABLE "PUBLIC"."FINANCING_EVENTS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_BF" PRIMARY KEY("ID");             
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.FINANCING_EVENTS;         
ALTER TABLE "PUBLIC"."PORTFOLIOS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_3" CHECK("PORTFOLIO_TYPE" IN('MARGIN', 'SPOT')) NOCHECK; 
ALTER TABLE "PUBLIC"."TRADE_CLOSURES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_5" CHECK("CLOSED_QUANTITY" >= 1) NOCHECK;            
ALTER TABLE "PUBLIC"."TRADES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_9" CHECK("QUANTITY" >= 1) NOCHECK;           
ALTER TABLE "PUBLIC"."TRADES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_93F" CHECK("FINANCING_RATE_TYPE" IN('FIXED', 'FLOATING')) NOCHECK;           
ALTER TABLE "PUBLIC"."FINANCING_EVENTS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_B" CHECK("EVENT_TYPE" IN('RATE_CHANGE', 'REPAYMENT', 'COLLATERAL_TOPUP')) NOCHECK; 
ALTER TABLE "PUBLIC"."SPOT_TRANSACTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_F" CHECK("TRANSACTION_TYPE" IN('DEPOSIT', 'WITHDRAW', 'BUY', 'SELL', 'DIVIDEND')) NOCHECK;        
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."UK_R43AF9AP4EDM43MMTQ01ODDJ6" UNIQUE("USERNAME");        
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."UK_6DOTKOTT2KJSP8VW4D0M25FB7" UNIQUE("EMAIL");           
ALTER TABLE "PUBLIC"."TRADES" ADD CONSTRAINT "PUBLIC"."FK9E3IESEPJP78AOQ0BT2WONIWT" FOREIGN KEY("PORTFOLIO_ID") REFERENCES "PUBLIC"."PORTFOLIOS"("ID") NOCHECK;
ALTER TABLE "PUBLIC"."SPOT_TRANSACTIONS" ADD CONSTRAINT "PUBLIC"."FKQFGRCA22O71EF4Y34TMO4DP4V" FOREIGN KEY("PORTFOLIO_ID") REFERENCES "PUBLIC"."PORTFOLIOS"("ID") NOCHECK;     
ALTER TABLE "PUBLIC"."FINANCING_EVENTS" ADD CONSTRAINT "PUBLIC"."FK51FRGVGRMMLY2XWCBSQ6642FK" FOREIGN KEY("TRADE_ID") REFERENCES "PUBLIC"."TRADES"("ID") NOCHECK;              
ALTER TABLE "PUBLIC"."TRADE_CLOSURES" ADD CONSTRAINT "PUBLIC"."FKS4TPUJJLEK041AV3JVKM19BFD" FOREIGN KEY("TRADE_ID") REFERENCES "PUBLIC"."TRADES"("ID") NOCHECK;
ALTER TABLE "PUBLIC"."PORTFOLIOS" ADD CONSTRAINT "PUBLIC"."FK9XT36KGM9CXSF79R2ME0D9F6U" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;      
